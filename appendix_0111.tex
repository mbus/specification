%\svnInfo $Id$

\section{MES 0111, ACK 1001, RST 010}

\subsection{An Ideal Transmission}
~

\begin{figure}[!h]
\begin{subfigure}{\textwidth}
    \ssmall
    \begin{tikztimingtable}[timing/slope=.3]
      %       |   D1    | D0  | D1  |     MES       |
      Din  & L 1.4L8{2H} 8{2L} 8{2H} 4{2L}11{2H}0.6H H \\
      Dout & L 0.0L8{2H} 8{2L} 8{2H} 4{2L}11{2H}2.0H H \\
      \\
      Din  & L 0.2L8{2H} 8{2L} 8{2H} 4{2L}11{2H}1.8H H \\
      Dout & L 0.4L8{2H} 8{2L} 8{2H} 4{2L}11{2H}1.6H H \\
      \\
      Din  & L 0.6L8{2H} 8{2L} 8{2H} 4{2L}11{2H}1.4H H \\
      Dout & L 0.8L8{2H} 8{2L} 8{2H} 4{2L}11{2H}1.2H H \\
      \\
      Din  & L 1.0L8{2H} 8{2L} 8{2H} 4{2L}11{2H}1.0H H \\
      Dout & L 1.2L8{2H} 8{2L} 8{2H} 4{2L}11{2H}0.8H H \\
      CLK  & C 40{2C}                                C \\
           & \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,semithick]
            \vertlines{1,17,...,81}
          \end{scope}
          \begin{scope}[semitransparent,semithick,dashed]
            \vertlines{9,25,...,81}
          \end{scope}
          \begin{scope}[semitransparent,semithick,dashed,color=red]
            \vertlines{5,13,...,81}
          \end{scope}
          \begin{scope}[semitransparent]
            % TX
            \filldraw[yellow] ( 1,-0.5)  rectangle ( 5,-2.5);
            \filldraw[yellow] (17,-0.5)  rectangle (21,-2.5);
            \filldraw[yellow] (33,-0.5)  rectangle (37,-2.5);
            \filldraw[yellow] (49,-0.5)  rectangle (53,-2.5);
            \filldraw[yellow] (57,-0.5)  rectangle (61,-2.5);
            \filldraw[yellow] (65,-0.5)  rectangle (69,-2.5);
            \filldraw[yellow] (73,-0.5)  rectangle (77,-2.5);
            % RX
            \filldraw[yellow] (81,-6.5)  rectangle (82,-8.5);
            % Clk
            \filldraw[yellow] ( 0,-20.5) rectangle (82,-22.5);
          \end{scope}
        \end{pgfonlayer}
        \begin{scope}
          [font=\sffamily\small,shift={(-3.0em,-0.5)},anchor=east,color=blue]
          \node at (  0,   0) {TX};
          \node at (  0,  -6) {RX};
          \node at (  0, -12) {Fwd};
          \node at (  0, -19) {Ctl};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=brown]
          \foreach \x [evaluate=\x] in {1,17,...,77}
            \foreach \offset/\l in {0/Drive1,4/Latch1,8/Drive2,12/Latch2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node[rotate=45] at (81,0) {Drive1};
        \end{scope}
        \begin{scope}
          [font=\small,anchor=south,shift={(1,-18em)}]
          \draw
            (0,0) node[] (a) {}
            (16,0) node[] (c) {}
            (32,0) node[] (e) {}
            (48,0) node[] (g) {}
            (80,0) node[] (i) {}
            (82,0) node[] (z) {\ldots};
          \node[right=4 of a] (b) {Data 1};
          \node[right=4 of c] (d) {Data 0};
          \node[right=4 of e] (f) {Data 1};
          \node[right=8 of g] (h) {End Sequence};
          \draw[->] (b.west) -- (a.east);
          \draw[<-] (c.west) -- (b.east);
          \draw[->] (d.west) -- (c.east);
          \draw[<-] (e.west) -- (d.east);
          \draw[->] (f.west) -- (e.east);
          \draw[<-] (g.west) -- (f.east);
          \draw[->] (h.west) -- (g.east);
          \draw[<-] (i.west) -- (h.east);
          %\draw[<-] (i.east) -- (z.west);
        \end{scope}
    \end{tikztimingtable}

    \begin{tikztimingtable}[timing/slope=.3]
      %       |         ACK           |
      Din  & H 1.0H4{2H}8{2L}3{2H}1.0H 0.2H8{2L}8{2H}8{2L}7{2H}1.8H H \\
      Dout & H 1.2H4{2H}8{2L}3{2H}0.8H 0.4H8{2L}8{2H}8{2L}7{2H}1.6H H \\
      \\
      Din  & H 1.4H4{2H}8{2L}3{2H}0.6H 0.6H8{2L}8{2H}8{2L}7{2H}1.4H H \\
      Dout & H 0.0H4{2H}8{2L}3{2H}2.0H 0.8H8{2L}8{2H}8{2L}7{2H}1.2H H \\
      \\
      Din  & H 0.2H4{2H}8{2L}3{2H}1.8H 1.0H8{2L}8{2H}8{2L}7{2H}1.0H H \\
      Dout & H 0.4H4{2H}8{2L}3{2H}1.6H 1.2H8{2L}8{2H}8{2L}7{2H}0.8H H \\
      \\
      Din  & H 0.6H4{2H}8{2L}3{2H}1.4H 1.4H8{2L}8{2H}8{2L}7{2H}0.6H H \\
      Dout & H 0.8H4{2H}8{2L}3{2H}1.2H 0.0H8{2L}8{2H}8{2L}7{2H}2.0H H \\
      CLK  & C 16{2C}4L15{4C}                                       H \\
      ~~~  & C 47{2C}2H                                             H \\
           & \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,semithick]
            \vertlines{1,17,...,32}
            \vertlines{37,53,69}
          \end{scope}
          \begin{scope}[semitransparent,semithick,dashed]
            \vertlines{9,25,...,32}
            \vertlines{97}
          \end{scope}
          \begin{scope}[semitransparent,semithick,dashed,color=red]
            \vertlines{5,13,...,32}
            \vertlines{45,61,77,85,93}
          \end{scope}
          \begin{scope}[semitransparent,semithick,color=blue]
            \vertlines{33,49,...,89}
          \end{scope}
          \begin{scope}[semitransparent,semithick,dashed,color=blue]
            \vertlines{41,57,...,89}
          \end{scope}
          \begin{scope}[semitransparent,yellow]
            % TX
            %\filldraw[yellow] ( 0,-0.5)  rectangle (1,-2.5);
            % RX
            \filldraw ( 1,-6.5)  rectangle ( 5,-8.5);
            \filldraw ( 9,-6.5)  rectangle (13,-8.5);
            \filldraw (17,-6.5)  rectangle (21,-8.5);
            \filldraw (25,-6.5)  rectangle (29,-8.5);
            % Clk
            \filldraw ( 0,-20.5) rectangle (33,-22.5);
          \end{scope}
          \begin{scope}[cyan,opacity=.25]
            \filldraw   (33,-18.5) rectangle (\twidth-1,-22.5);
          \end{scope}
        \end{pgfonlayer}
        \begin{scope}
          [font=\sffamily\small,shift={(-3.0em,-0.5)},anchor=east,color=blue]
          \node at (  0,   0) {TX};
          \node at (  0,  -6) {RX};
          \node at (  0, -12) {Fwd};
          \node at (  0, -19) {Ctl};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=brown]
          \foreach \x [evaluate=\x] in {1,17,...,29}
            \foreach \offset/\l in {0/Drive1,4/Latch1,8/Drive2,12/Latch2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \def\base{37}
          \node [rotate=45] at (\base+0, 0) {Drive1};
          \node [rotate=45] at (\base+8, 0) {Latch1};
          \node [rotate=45] at (\base+16, 0) {Drive2};
          \node [rotate=45] at (\base+24, 0) {Latch2};
          \node [rotate=45] at (\base+32, 0) {Drive1};
          \node [rotate=45] at (\base+40, 0) {Latch1};
          \node [rotate=45] at (\base+48, 0) {Reset};
          \node [rotate=45] at (\base+56, 0) {Reset};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=blue]
          \def\base{33}
          \node [rotate=45] at (\base, 0) {Reset-S0-D};
          \node [rotate=45] at (\base+8, 0) {Reset-S0-L};
          \node [rotate=45] at (\base+16, 0) {Reset-S1-D};
          \node [rotate=45] at (\base+24, 0) {Reset-S1-L};
          \node [rotate=45] at (\base+32, 0) {Reset-S0-D};
          \node [rotate=45] at (\base+40, 0) {Reset-S0-L};
          \node [rotate=45] at (\base+48, 0) {Reset-R-D};
          \node [rotate=45] at (\base+56, 0) {Reset-R-L};
          \node [rotate=45,color=black] at (\base+64, 0) {Idle};
        \end{scope}
        \begin{scope}
          [font=\small,anchor=south,shift={(1,-19.5em)}]
          \draw
            (-2,0) node[] (z) {\ldots}
            (0,0) node[] (a) {}
            (32,0) node[] (c) {}
            (97,0) node[] (e) {};
          \node[right=6 of a] (b) {Acknowledgement};
          \node[right=28 of c] (d) {Reset};
          %\draw[->] (z.east) -- (a.west);
          \draw[->] (b.west) -- (a.east);
          \draw[<-] (c.west) -- (b.east);
          \draw[->] (d.west) -- (c.east);
          \draw[<-] (e.west) -- (d.east);
        \end{scope}
    \end{tikztimingtable}
\end{subfigure}
  \label{fig:reset-normal}
%}
  \caption{A normal end sequence, showing the last three bits sent (1, 0, 1)
followed by a Message~End~Sequence and Message~Acknowledgement. During reset,
the control node halves the clock speed it puts on the bus for phase-locking.}
\end{figure}

\subsection{$1\phi$ Offset}

\begin{figure}[!h]
\noindent\makebox[\textwidth]{%
    \tiny
    \begin{tikztimingtable}[timing/slope=.3]
      %       |  D1   |  D0   |  D1   |    MES        |   ACK               |
      Din  & L 8{1.5H} 8{1.5L} 8{1.5H} 4{1.5L}12{1.5H} 4{1.5H}8{1.5L}4{1.5H}
      %       | Reset
               8{1.5L}8{1.5H}8{1.5L}6{1.5H} H \\
      CLK  & C 56{1.5C}3L14{3C} C \\
      Bus  & D{}{12D{Data 1}}{12D{Data 0}}{12D{Data 1}}{24D{MES}}{24D{ACK}}{45D{Reset}}D \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,semithick,dashed,color=red]
            \vertlines{1,7,...,83}
            \vertlines{88,100,112,118,124}
          \end{scope}
          \begin{scope}[semitransparent,semithick,dashed]
            \vertlines{4,10,...,87}
            \vertlines{94,106,130}
          \end{scope}
          \begin{scope}[cyan,opacity=.25]
            % Reset
            \filldraw  (82,-.5) rectangle (130,-2.5);
          \end{scope}
        \end{pgfonlayer}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=red]
          \foreach \x [evaluate=\x] in {1,13,...,79}
            \foreach \offset/\l in {0/Latch2,3/Drive1,6/Latch1,9/Drive2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (88,0) {Latch2};
          \node [rotate=45] at (94,0) {Drive1};
          \node [rotate=45] at (100,0) {Latch1};
          \node [rotate=45] at (106,0) {Drive2};
          \node [rotate=45] at (112,0) {Latch2};
          \node [rotate=45] at (118,0) {Reset (D)};
          \node [rotate=45] at (124,0) {Reset (L)};
          \node [rotate=45,color=black] at (130,0) {Idle (L)};
        \end{scope}
    \end{tikztimingtable}
}
\caption{A nominal transmission (1, 0, 1, MES, ACK, Reset) labeling the states
as $1\phi$ behind. The {\tt CLK} and {\tt Bus} lines reflect the actual bus
values, not those as interpreted by the $1\phi$ behind node.
}
\label{fig:1-phi}
\end{figure}

\subsubsection{Detail view of some sequences}
~
\begin{figure}[h]
\begin{subfigure}{\textwidth}
    \tiny
    \begin{tikztimingtable}[timing/slope=.3,timing/wscale=1.0]
      %       |    D0     || D1  ||   D0   {}  RD0      ||  R1D     ||  R0D     || Re-Reset
      Din  & L 0.8L  4L12L  4H12H2.2LXX3H4H  4L0.8L8L  4L4H  4H4H4H    4L4L4L 4L        \\
      Dout & L 0.0L  4L12L  4H12H  4L X3H4H  4L    8L  4H4H  4H4H4H0.8H4L4L4L 4L        \\
      ~~~~ & D{}{16D{Data 0}}{16D{Data 1}}{24D{Data 0}}{24D{Data 1}}{28D{Reset}}D \\
      \\
      Din  & L 0.0L  4L11LXX3H11HXX3L  4H4H  4L    7LXX3H4H  4H4H4H1.0H4L4L4L 4L    \\
      Dout & L 0.0L  4L11LXX3H11HXX3L  4H4H  4L    8L X3H4H  4L4L4L    4L4L4L 4L    \\
      ~~~~ & {5D{Data 0}}{32D{End Sequence}}{36D{Acknowledgement Attempt}}{36D{Error (Forwarding)}}D \\
      %\\
      Din  & L 0.5L  4L12L  4H12H  4L  4H4H  4L    8L  4H4H  4L4L4L    4L4L4L 4L   \\
      Dout & L 0.5L  4L12L  4H12H  4L3.5H4H  4L    8L  4L4H  4H4H4H    4L4L4L 4L    \\
      CLK  & C22{2C}4L15{4C}C \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,dashed]
            \vertlines{1,9,...,41}
            \pgfmathparse{\twidth-4}
            \vertlines{49,57,...,\pgfmathresult}
            \vertlines[color=red]{5,13,...,41}
            \vertlines[color=blue]{45,53,...,\pgfmathresult}
            \pgfmathparse{\twidth-1}
            \vertlines{\pgfmathresult}
          \end{scope}
          \begin{scope}[thick]
            \draw[blue]  (39,-13.5) ellipse (3 and 1.25);
            \draw[blue]  (69,-14.5) ellipse (1.25 and 2);
          \end{scope}
          \begin{scope}[semitransparent]
            % TX
            \filldraw[yellow]    ( 1,-0.5) rectangle ( 5,-2.5);
            \filldraw[yellow]    (17,-0.5) rectangle (21,-2.5);
            \filldraw[yellow]    (33,-0.5) rectangle (37,-2.5);
            \filldraw[yellow]    (57,-0.5) rectangle (65,-2.5);
            % RX
            \filldraw[yellow]    (37,-8.5) rectangle (41,-10.5);
            \filldraw[yellow]    (49,-8.5) rectangle (57,-10.5);
            \filldraw[yellow]    (65,-8.5) rectangle (73,-10.5);
            % CLK
            \filldraw[yellow]    ( 1,-16.5) rectangle (45,-18.5);
            \filldraw[cyan,opacity=.25] (45,-14.5) rectangle (\twidth-1, -18.5);
          \end{scope}
          \foreach \n [evaluate=\n as \l using int((\n-1)/4)] in {1,5,...,\twidth}
            \draw (\n,-19) -- +(0,-.2)
              node [below,inner sep=2pt] {\scalebox{.75}{\tiny\l}};
        \end{pgfonlayer}
        \begin{scope}
          [font=\sffamily\small,shift={(-3.0em,-0.5)},anchor=east,color=blue]
          \node at (  0,   0) {TX};
          \node at (  0,  -8) {RX};
          \node at (  0, -15) {Ctl};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=brown]
          \foreach \x [evaluate=\x] in {1,17,...,31}
            \foreach \offset/\l in {0/Drive1,4/Latch1,8/Drive2,12/Latch2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (33,0) {Drive1};
          \node [rotate=45] at (37,0) {Latch1};
          \node [rotate=45] at (41,0) {Drive2};

          \def\base{49}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive1};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\bf\tiny,anchor=north,shift={(.2,-3.1em)},color=red]
          \foreach \x [evaluate=\x] in {1,17,...,31}
            \foreach \offset/\l in {0/L2,4/D1,8/L1,12/D2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (33,0) {L2};
          \node [rotate=45] at (37,0) {D1};
          \node [rotate=45] at (41,0) {L1};

          \def\base{49}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {D2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L2};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=blue]
          \def\base{45}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-L};
          \pgfmathparse{\pgfmathresult+8}
          \node at (\pgfmathresult, 0)  {\normalsize\ldots};
        \end{scope}
    \end{tikztimingtable}
    \caption{\footnotesize
      Transmitter is sending data bits 0, 1, 0 ({\tt 001100}).
      The 0, 1, 1 ({\tt 001111}) case is considered in~\ref{fig:1-phi-tx011}.
      Sending 0, 1, MES ({\tt 00110111}) would cause the TX node to latch a
      {\tt 0} at time 12 for the second half-bit of the MES sequence and enter
      reset earlier than is shown here.
      If at time 14 the next half-bit was a {\tt 0} instead of a {\tt 1}, the
      TX node would simply enter reset earlier at time 16 when the {\sc latch1}
      did not match the driven value. The second half-bit driven at time 18 is
      irrelevant, as the {\sc latch2} at time 20 will unconditionally enter
      reset as the latches at time 12, 16, and 20 make up the {\tt 010} reset
      sequence.
    }
    \label{fig:1-phi-tx010}


    \begin{tikztimingtable}[timing/slope=.3,timing/wscale=1.0]
      %       |    D0     || D1  || D1            || RST
      Din  & L 0.8L  4L12L  4H12H 3.2H4H3HXX3L  4L 16.5L16H16L16H               0.5H \\
      Dout & L 0.0L  4L12L  4H12H   4H4H3HXX3L  4L    4L 4L4L4.5L 16H16L16H     0.5H \\
      ~~~~ & D{}{16D{Data 0}}{16D{Data 1}}{16D{Data 1}}{24D{Data 0}}
                {16D{Err (FWD)}}{28D{Reset}} D \\
      \\
      Din  & L 0.0L  4L11LXX3H12H   4H4H4H H2LLL3L    4L 4L4L4.8L 16H16L16H     0.2H \\
      Dout & L 0.0L  4L11LXX3H12H   4H4H4H  4L L3L    4L 4L 4L 4L 16.8H 16L 16H 0.2H\\
      ~~~~ & {5D{Data 0}}{32D{End Sequence}}
             {8D{ACK 1}}{12D{ACK 0}}{16D{ACK 0}}{16D{ACK 1}}{8D{FWD}}{20D{Reset}} D \\
      %\\
      Din  & L 0.5L  4L12L  4H12H   4H4H4H  4L  4L    4L 4L 4L 4L 16.5H 16L 16H 0.0H\\
      Dout & L 0.5L  4L12L  4H12H   4H4H4H  4L3.5L   16L16H16L16H               1.0H \\
      CLK  & C26{2C}4L15{4C}H \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,dashed]
            \vertlines{1,9,...,49}
            \pgfmathparse{\twidth-4}
            \vertlines{49,57,...,\pgfmathresult}
            \vertlines[color=red]{5,13,...,45}
            \vertlines[color=blue]{53,61,...,\pgfmathresult}
            \pgfmathparse{\twidth-1}
            \vertlines{\pgfmathresult}
          \end{scope}
          \begin{scope}[thick]
            \draw[blue]  (47,-13.5) ellipse (3 and 1.25);
            %\draw[blue]  (69,-14.5) ellipse (1.25 and 2);
          \end{scope}
          \begin{scope}[semitransparent]
            % TX
            \filldraw[yellow]    ( 1,-0.5) rectangle ( 5,-2.5);
            \filldraw[yellow]    (17,-0.5) rectangle (21,-2.5);
            \filldraw[yellow]    (33,-0.5) rectangle (37,-2.5);
            \filldraw[yellow]    (49,-0.5) rectangle (53,-2.5);
            %\filldraw[yellow]    (57,-0.5) rectangle (65,-2.5);
            % RX
            \filldraw[yellow]    (37,-8.5) rectangle (41,-10.5);
            \filldraw[yellow]    (45,-8.5) rectangle (49,-10.5);
            %\filldraw[yellow]    (49,-8.5) rectangle (57,-10.5);
            %\filldraw[yellow]    (65,-8.5) rectangle (73,-10.5);
            % CLK
            \filldraw[yellow]    ( 1,-16.5) rectangle (53,-18.5);
            \filldraw[cyan,opacity=.25] (53,-14.5) rectangle (\twidth-1, -18.5);
          \end{scope}
          \foreach \n [evaluate=\n as \l using int((\n-1)/4)] in {1,5,...,\twidth}
            \draw (\n,-19) -- +(0,-.2)
              node [below,inner sep=2pt] {\scalebox{.75}{\tiny\l}};
        \end{pgfonlayer}
        \begin{scope}
          [font=\sffamily\small,shift={(-3.0em,-0.5)},anchor=east,color=blue]
          \node at (  0,   0) {TX};
          \node at (  0,  -8) {RX};
          \node at (  0, -15) {Ctl};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=brown]
          \foreach \x [evaluate=\x] in {1,17,...,47}
            \foreach \offset/\l in {0/Drive1,4/Latch1,8/Drive2,12/Latch2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (49,0) {Drive1};

          \def\base{57}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Idle1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Idle2};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\bf\tiny,anchor=north,shift={(.2,-3.1em)},color=red]
          \foreach \x [evaluate=\x] in {1,17,...,47}
            \foreach \offset/\l in {0/L2,4/D1,8/L1,12/D2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (49,0) {L2};

          \def\base{57}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {D1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {**};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=blue]
          \def\base{53}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-I1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-I2};
          \pgfmathparse{\pgfmathresult+8}
          \node [color=black] at (\pgfmathresult, 0)  {Idle};
        \end{scope}
    \end{tikztimingtable}
    \caption{\footnotesize
      Transmitter is sending data bits 0, 1, 1 ({\tt 001111}).
      If the next TX half-bit was {\tt 1} instead of {\tt 0}, it would fail
      to latch at time 14, entering Reset earlier. Here we show the second
      half-bit to also be {\tt 0}, if instead it was {\tt 1}---beginning a
      Message~End~Sequence---, the TX node would have driven its output high
      at time 16, presenting a possible opportunity to reset the RX node. The
      TX node would still enter Reset at time 22, as it has latched the
      {\tt 010} Reset sequence at times 14, 18, and 22.
      In both cases, however, the TX node enters Reset and fails the
      transmission while the RX node believes it has ACK'd a complete
      transmission.
    }
    \label{fig:1-phi-tx011}

    \begin{tikztimingtable}[timing/slope=.3,timing/wscale=1.0]
      %       |    D0     || D1  || MES 0111         || ACK? || Reset
      Din  & L 0.8L  4L12L  4H12H  4L4L  4H4H4H4H4H4H2.2HXX3L4.5L 16L16H15.5L \\
      Dout & L 0.0L  4L12L  4H12H  4L4L  4H4H4H4H4H4H  3HXX3L4.5L 16L16H15.5L \\
      ~~~~ & D{}{16D{Data 0}}{16D{Data 1}}{32D{Message End Sequence}}{16D{Acknowledgement??}}{44D{Reset}} \\
      \\
      Din  & L 0.0L  4L11LXX3H11HXX3L3LXX3H4H4H4H4H4H  4H H4L  4L 16L16H15L   \\
      Dout & L 0.0L  4L11LXX3H11HXX3L3LXX3H4H4H4H4H4H  4H  4L  8L 8H5L16H15L     \\
      ~~~~ & {5D{}}{16D{Data 0}}{16D{Data 1}}{32D{Message End Sequence}}{20D{Acknowledgement}}{36D{Reset}} \\
      %\\
      Din  & L 0.5L  4L12L  4H12H  4L4L  4H4H4H4H4H4H  4H  4L  8L 8H5L16H14.5L   \\
      Dout & L 0.5L  4L12L  4H12H  4L4L  4H4H4H4H4H4H  4H  4L3.5L16L16H16L \\
      CLK  & C38{2C}4L11{4C} \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,dashed]
            \vertlines{1,9,...,41}
            \pgfmathparse{\twidth-4}
            \vertlines{49,57,...,\pgfmathresult}
            \vertlines[color=red]{5,13,...,41}
            \vertlines[color=blue]{45,53,...,\pgfmathresult}
          \end{scope}
          \begin{scope}[thick]
            \draw[blue]  (71,-13.5) ellipse (3 and 1.25);
            \draw[blue]  (85,-14.5) ellipse (1.25 and 2);
          \end{scope}
          \begin{scope}[semitransparent]
            % TX
            \filldraw[yellow]    ( 1,-0.5) rectangle ( 5,-2.5);
            \filldraw[yellow]    (17,-0.5) rectangle (21,-2.5);
            \filldraw[yellow]    (33,-0.5) rectangle (37,-2.5);
            \filldraw[yellow]    (41,-0.5) rectangle (45,-2.5);
            % RX
            \filldraw[yellow]    (69,-8.5) rectangle (73,-10.5);
            \filldraw[yellow]    (81,-8.5) rectangle (89,-10.5);
            % CLK
            \filldraw[yellow]    ( 1,-16.5) rectangle (77,-18.5);
            \filldraw[cyan,opacity=.25] (77,-14.5) rectangle (\twidth, -18.5);
          \end{scope}
          \foreach \n [evaluate=\n as \l using int((\n-1)/4)] in {1,5,...,\twidth}
            \draw (\n,-19) -- +(0,-.2)
              node [below,inner sep=2pt] {\scalebox{.75}{\tiny\l}};
        \end{pgfonlayer}
        \begin{scope}
          [font=\sffamily\small,shift={(-3.0em,-0.5)},anchor=east,color=blue]
          \node at (  0,   0) {TX};
          \node at (  0,  -8) {RX};
          \node at (  0, -15) {Ctl};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=brown]
          \foreach \x [evaluate=\x] in {1,17,...,63}
            \foreach \offset/\l in {0/Drive1,4/Latch1,8/Drive2,12/Latch2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (65,0) {Drive1};
          \node [rotate=45] at (69,0) {Latch1};
          \node [rotate=45] at (73,0) {Drive2};

          \def\base{81}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive1};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\bf\tiny,anchor=north,shift={(.2,-3.1em)},color=red]
          \foreach \x [evaluate=\x] in {1,17,...,63}
            \foreach \offset/\l in {0/L2,4/D1,8/L1,12/D2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (65,0) {L2};
          \node [rotate=45] at (69,0) {D1};
          \node [rotate=45] at (73,0) {L1};

          \def\base{81}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {D2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L2};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=blue]
          \def\base{77}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+9}
          \node at (\pgfmathresult, 0)  {\normalsize\ldots};
        \end{scope}
    \end{tikztimingtable}
    \caption{\footnotesize
      A detail examination of transmitting a 1 transitioning to a
      Message~End~Sequence ({\tt 110111}). We examine the most pathological
      case here, that is latching {\tt 0} at time 4 (otherwise in the above
      case), {\tt 1} at time 8 (otherwise {\tt 01} enters Reset), and {\tt 0}
      at time 10.
    }
    \label{fig:1-phi-tx1mes}


    \begin{tikztimingtable}[timing/slope=.3,timing/wscale=1.0]
      %       || MES 01 || MES 11 || ACK 10   |  || RST
      \\
      Din  & L4.8L4L4H4H   15.2H    9.0H4H3.0L 4L16.5L16H16L      16H 0.5H  \\
      Dout & L4.8L4L4H4H   15.2H      8H4H  4L 4L 4.5L12L 16H 16L 16H 0.5H  \\
      ~~~~ & D{}{8D{Data 0?}}{8D{MES 1}}{8D{MES 1}}{8D{MES 1}}
                {12D{ACK 1}}{12D{ACK 0}}{16D{ACK 0}}{16D{ACK 1}}
                {8D{FWD}}{16D{Reset}}{5D{Idle}}   \\
      %\\
      Din  & L5.0L4L4H4H   15.0H      8H3HXX3L 4L4.8L12L  16H 16L 16H 0.2H \\
      Dout & L  4L4L4H4H     16H      8H3HXX3L 4L4.8L12L  16H 16L 16H 0.2H \\
      ~~~~ & D{}{8D{MES 0}}{8D{MES 1}}{8D{MES 1}}{8D{MES 1}}
                {8D{ACK 1}}{8D{ACK ???}}{16D{ACK 0}}{16D{ACK 1}}
                {8D{FWD}}{24D{Reset}}{5D{Idle}} \\
      %\\
      Din  & L4.5L4L4H4H   15.5H    8.8H4H3.2L 4L5.0L12L  16H 16L 16H 0.0H \\
      Dout & L4.5L4L4H4H   15.5H    8.8H4H3.2L 4L  16L16H16L      16H    H \\
      CLK  & C26{2C}4L15{4C} H \\
      \extracode
        \begin{pgfonlayer}{background}
          \begin{scope}[semitransparent,dashed]
            \pgfmathparse{\twidth-1}
            \vertlines{1,9,...,49,\pgfmathresult}
            \pgfmathparse{\twidth-4}
            \vertlines{49,57,...,\pgfmathresult}
            \vertlines[color=red]{5,13,...,49}
            \vertlines[color=blue]{53,61,...,\pgfmathresult}
          \end{scope}
          \begin{scope}[thick]
            \draw[blue]  (47,-13.5) ellipse (3 and 1.25);
            %\draw[blue]  (85,-14.5) ellipse (1.25 and 2);
          \end{scope}
          \begin{scope}[semitransparent]
            % RX
            \filldraw[yellow]    (45,-0.5) rectangle (49,-2.5);
            \filldraw[yellow]    (73,-0.5) rectangle (77,-2.5);
            % TX
            \filldraw[yellow]    ( 1,-8.5) rectangle ( 5,-10.5);
            \filldraw[yellow]    ( 9,-8.5) rectangle (13,-10.5);
            % CLK
            \filldraw[yellow]    ( 1,-16.5) rectangle (53,-18.5);
            \filldraw[cyan,opacity=.25] (53,-14.5) rectangle (\twidth, -18.5);
          \end{scope}
          \foreach \n [evaluate=\n as \l using int((\n-1)/4)] in {1,5,...,\twidth}
            \draw (\n,-19) -- +(0,-.2)
              node [below,inner sep=2pt] {\scalebox{.75}{\tiny\l}};
        \end{pgfonlayer}
        \begin{scope}
          [font=\sffamily\small,shift={(-3.0em,-0.5)},anchor=east,color=blue]
          \node at (  0,   0) {RX};
          \node at (  0,  -8) {TX};
          \node at (  0, -15) {Ctl};
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=brown]
          \foreach \x [evaluate=\x] in {1,17,...,33}
            \foreach \offset/\l in {0/Drive1,4/Latch1,8/Drive2,12/Latch2}
              \node [rotate=45] at (\x+\offset,0) {\l};
          \node [rotate=45] at (49,0) {Drive1};

          \def\base{57}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Latch1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Drive2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Idle1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {Idle2};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\bf\tiny,anchor=north,shift={(.2,0.9em)},color=red]
          \node [rotate=45] at (41,0) {**};
          \node [rotate=45] at (45,0) {D2};
          \node [rotate=45] at (49,0) {L2};

          \def\base{57}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {D1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L2};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {D1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {L1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {**};
          \pgfmathparse{\pgfmathresult+8}
        \end{scope}
        \begin{scope}
          [font=\sc\tiny,anchor=north,shift={(0,3em)},color=blue]
          \def\base{53}
          \pgfmathparse{\base+0}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-L};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-D};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R0-L};
          \pgfmathparse{\pgfmathresult+9}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-I1};
          \pgfmathparse{\pgfmathresult+8}
          \node [rotate=45] at (\pgfmathresult, 0)  {R1-I2};
        \end{scope}
    \end{tikztimingtable}
    \caption{\footnotesize
      Uncertainty can occur if the $1\phi$ slip is too late. In
      particular, if the slip occurs during the Acknowledgement phase, the
      result is non-deterministic. At time 11, the TX node may latch a {\tt 0},
      in which case the transmission will succeed. If it latches a {\tt 1},
      however, the TX node will consider the transmission a failure while the
      RX node will believe it sucessfully ACK'd and will forward the message
      as fully received. The bus is still correctly reset and re-aligned at
      the end of the transmission.
    }
    \label{fig:1-phi-last-chance}

\end{subfigure}
\caption{Detailed timing digrams of a $1\phi$ errors. The top labels are the
current global bus state. The red labels above the RX waveform indicate the
local $1\phi$ state machine. {\tt DOUT} lines are colored to indicate when a
node is driving (yellow), otherwise it is forwarding its {\tt DIN} value. The
control layer enters reset in the blue-colored block and continuously drives
{\tt DOUT}.
}
\label{fig:reset-1phi-tx-0-1}
\end{figure}
